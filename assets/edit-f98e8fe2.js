import{N as A}from"./Net-6d2be279.js";import{p as ie,g as se,bh as ue,a as ce,c as C,r as V,av as de,a6 as fe,aK as me,w as y,a_ as ve,e as he,f as ge,h as o,i as M,F as D,O,aV as xe,bi as Ve,b7 as ye,n as U,bj as we,ab as be,a9 as ke,_ as pe,a4 as S,J as w,K as P,L as g,Y as _e,Z as Fe,R as K,S as $,Q as Ce,N as j}from"./index-7b18db42.js";import{V as Se}from"./VContainer-c158e618.js";import{V as Pe}from"./VRow-201d21fb.js";import{V as De}from"./VForm-81e02aa0.js";import{V as Re}from"./VCol-3ea23240.js";import{c as Ie,a as Be,u as Ne,d as L,f as Ae,V as Me,e as Ue}from"./VInput-d9476373.js";import{V as Te}from"./VSwitch-5ef162ca.js";import"./index-5ee1173a.js";import"./VSelectionControl-9aeb4273.js";const He=ie({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...Ie(),...Be()},"VTextarea"),ze=se()({name:"VTextarea",directives:{Intersect:ue},inheritAttrs:!1,props:He(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,s){let{attrs:i,emit:c,slots:l}=s;const n=ce(e,"modelValue"),{isFocused:a,focus:x,blur:J}=Ne(e),Q=C(()=>typeof e.counterValue=="function"?e.counterValue(n.value):(n.value||"").toString().length),Y=C(()=>{if(i.maxlength)return i.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter});function Z(t,u){var r,d;!e.autofocus||!t||(d=(r=u[0].target)==null?void 0:r.focus)==null||d.call(r)}const T=V(),b=V(),H=de(""),k=V(),W=C(()=>e.persistentPlaceholder||a.value||e.active);function R(){var t;k.value!==document.activeElement&&((t=k.value)==null||t.focus()),a.value||x()}function X(t){R(),c("click:control",t)}function ee(t){c("mousedown:control",t)}function te(t){t.stopPropagation(),R(),U(()=>{n.value="",we(e["onClick:clear"],t)})}function ae(t){var r;const u=t.target;if(n.value=u.value,(r=e.modelModifiers)!=null&&r.trim){const d=[u.selectionStart,u.selectionEnd];U(()=>{u.selectionStart=d[0],u.selectionEnd=d[1]})}}const v=V(),p=V(+e.rows),I=C(()=>["plain","underlined"].includes(e.variant));fe(()=>{e.autoGrow||(p.value=+e.rows)});function h(){e.autoGrow&&U(()=>{if(!v.value||!b.value)return;const t=getComputedStyle(v.value),u=getComputedStyle(b.value.$el),r=parseFloat(t.getPropertyValue("--v-field-padding-top"))+parseFloat(t.getPropertyValue("--v-input-padding-top"))+parseFloat(t.getPropertyValue("--v-field-padding-bottom")),d=v.value.scrollHeight,_=parseFloat(t.lineHeight),B=Math.max(parseFloat(e.rows)*_+r,parseFloat(u.getPropertyValue("--v-input-control-height"))),N=parseFloat(e.maxRows)*_+r||1/0,m=ke(d??0,B,N);p.value=Math.floor((m-r)/_),H.value=be(m)})}me(h),y(n,h),y(()=>e.rows,h),y(()=>e.maxRows,h),y(()=>e.density,h);let f;return y(v,t=>{t?(f=new ResizeObserver(h),f.observe(v.value)):f==null||f.disconnect()}),ve(()=>{f==null||f.disconnect()}),he(()=>{const t=!!(l.counter||e.counter||e.counterValue),u=!!(t||l.details),[r,d]=ge(i),{modelValue:_,...B}=L.filterProps(e),N=Ae(e);return o(L,M({ref:T,modelValue:n.value,"onUpdate:modelValue":m=>n.value=m,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-input--plain-underlined":I.value},e.class],style:e.style},r,B,{centerAffix:p.value===1&&!I.value,focused:a.value}),{...l,default:m=>{let{id:F,isDisabled:z,isDirty:G,isReadonly:le,isValid:oe}=m;return o(Me,M({ref:b,style:{"--v-textarea-control-height":H.value},onClick:X,onMousedown:ee,"onClick:clear":te,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},N,{id:F.value,active:W.value||G.value,centerAffix:p.value===1&&!I.value,dirty:G.value||e.dirty,disabled:z.value,focused:a.value,error:oe.value===!1}),{...l,default:ne=>{let{props:{class:E,...q}}=ne;return o(D,null,[e.prefix&&o("span",{class:"v-text-field__prefix"},[e.prefix]),O(o("textarea",M({ref:k,class:E,value:n.value,onInput:ae,autofocus:e.autofocus,readonly:le.value,disabled:z.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:R,onBlur:J},q,d),null),[[xe("intersect"),{handler:Z},null,{once:!0}]]),e.autoGrow&&O(o("textarea",{class:[E,"v-textarea__sizer"],id:`${q.id}-sizer`,"onUpdate:modelValue":re=>n.value=re,ref:v,readonly:!0,"aria-hidden":"true"},null),[[Ve,n.value]]),e.suffix&&o("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:u?m=>{var F;return o(D,null,[(F=l.details)==null?void 0:F.call(l,m),t&&o(D,null,[o("span",null,null),o(Ue,{active:e.persistentCounter||a.value,value:Q.value,max:Y.value},l.counter)])])}:void 0})}),ye({},T,b,k)}}),Ge={data(){return{valid:!0,formData:{self_id:0,group_id:0},fields:[],field:{}}},methods:{async submitForm(){var e=await new A("/v1/group/function/edit").PostFormData(this.formData);e.isSuccess?(S.SetAlert(e.echo),this.$router.go(-1)):S.SetAlert(e.echo)},back(){this.$router.go(-1)},async getDetail(){var e=await new A("/v1/group/function/detail").Get();if(e.isSuccess){const s=e.data;for(const i in s){const c=s[i];this.fields.push({key:c.key,label:c.name,type:c.type,rules:[]}),this.field[c.key]=c.type}this.fillForm()}else S.SetAlert(e.echo)},async fillForm(){var e=await new A("/v1/group/function/get").PostFormData({self_id:this.$route.query.self_id,group_id:this.$route.query.group_id});if(e.isSuccess){let s=e.data;for(const i in s)switch(this.field[i]){case"bool":this.formData[i]=!!s[i];break;default:this.formData[i]=s[i];break}}else S.SetAlert(e.echo)}},created(){this.formData.self_id=this.$route.query.self_id,this.formData.group_id=this.$route.query.group_id,this.getDetail()}};function Ee(e,s,i,c,l,n){return w(),P(Se,null,{default:g(()=>[o(De,{modelValue:l.valid,"onUpdate:modelValue":s[0]||(s[0]=a=>l.valid=a),ref:"form",onSubmit:Ce(n.submitForm,["prevent"])},{default:g(()=>[o(Pe,null,{default:g(()=>[(w(!0),_e(D,null,Fe(l.fields,a=>(w(),P(Re,{key:a.key,cols:"12",md:"6"},{default:g(()=>[a.type==="string"?(w(),P(ze,{key:0,"hide-details":"false",label:a.label,modelValue:l.formData[a.key],"onUpdate:modelValue":x=>l.formData[a.key]=x,rules:a.rules},null,8,["label","modelValue","onUpdate:modelValue","rules"])):j("",!0),a.type==="bool"?(w(),P(Te,{key:1,inset:"",label:a.label,modelValue:l.formData[a.key],"onUpdate:modelValue":x=>l.formData[a.key]=x},null,8,["label","modelValue","onUpdate:modelValue"])):j("",!0)]),_:2},1024))),128))]),_:1}),o(K,{type:"submit",disabled:!l.valid,block:"",color:"primary",class:"mt-4"},{default:g(()=>[$("提交")]),_:1},8,["disabled"]),o(K,{block:"",color:"grey",class:"mt-4",onClick:n.back},{default:g(()=>[$("返回")]),_:1},8,["onClick"])]),_:1},8,["modelValue","onSubmit"])]),_:1})}const We=pe(Ge,[["render",Ee]]);export{We as default};
